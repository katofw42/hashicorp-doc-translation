# HashiCorp Docs 翻訳ツール - 進捗状況

## 完了した機能

### コア機能

- [x] **基本的なHTML取得機能**
  - Playwrightを使用したウェブページアクセス
  - `#main` 要素からのHTMLコンテンツ抽出
  - 複数URLの順次処理

- [x] **HTML→Markdown変換**
  - OpenRouter APIを使用したHTML→英語Markdown変換
  - プロンプトテンプレートの外部ファイル化
  - 変換結果のファイル保存

- [x] **英語→日本語翻訳**
  - OpenRouter APIを使用した英語Markdown→日本語翻訳
  - プロンプトテンプレートの外部ファイル化
  - 翻訳結果のファイル保存

- [x] **環境変数による設定**
  - APIキーの外部管理
  - モデル名のカスタマイズ
  - プロンプトファイルパスのカスタマイズ

### 最近完了した機能強化 (2025/5/7)

- [x] **ファイル名の簡略化**
  - 冗長な接頭語 "developer.hashicorp.com-vault-docs" の削除
  - URLのパス構造を反映したファイル名生成

- [x] **大きなドキュメントの分割処理**
  - 見出し（H1, H2）ベースの分割戦略の実装
  - 最大5000文字のチャンクサイズでの処理
  - 分割されたチャンクの順次処理と結合

- [x] **ファイルパス生成ロジックの改善**
  - URLのパス構造をファイルシステムの構造として反映
  - 必要なディレクトリの自動作成
  - ファイル書き込み前のディレクトリ存在確認

- [x] **翻訳禁止単語リスト機能**
  - 翻訳せずにそのまま保持する単語リストの外部ファイル化
  - プロンプトへの翻訳禁止単語リストの組み込み

## 進行中の作業

- [ ] **エラーハンドリングの強化**
  - より詳細なエラーメッセージ
  - 自動リトライ機能
  - 部分的な失敗からの回復メカニズム

- [ ] **翻訳品質の向上**
  - プロンプトテンプレートの最適化
  - より高性能なLLMモデルの検討
  - 翻訳禁止単語リストの拡充

## 今後の計画

### 短期計画 (1-2週間)

- [ ] **並列処理の導入**
  - 複数URLの同時処理
  - 処理速度の向上

- [ ] **進捗表示の強化**
  - 処理状況の詳細表示
  - 残り時間の推定

- [ ] **エラーレポートの改善**
  - エラーログの構造化
  - 問題箇所の特定支援

### 中期計画 (1-2ヶ月)

- [ ] **ユーザーインターフェースの改善**
  - コマンドライン引数のサポート
  - 設定ファイルのサポート
  - 対話モードの検討

- [ ] **キャッシュ機構の導入**
  - 変換/翻訳結果のキャッシュ
  - 差分処理による効率化

- [ ] **テスト自動化**
  - 単体テストの導入
  - 統合テストの導入
  - CI/CDパイプラインの検討

### 長期計画 (3-6ヶ月)

- [ ] **他のHashiCorp製品対応**
  - Consul, Nomad, Terraform等のドキュメント対応
  - 製品固有の翻訳調整

- [ ] **多言語対応**
  - 日本語以外の言語への拡張
  - 言語固有の翻訳調整

- [ ] **ウェブインターフェース**
  - ブラウザベースのUI
  - 翻訳管理ダッシュボード

## 既知の問題

### 高優先度

- [ ] **大きなHTMLコンテンツの処理制限**
  - 問題: 非常に大きなHTMLコンテンツはAPIのトークン制限を超える可能性がある
  - 現状: 警告ログを出力するが、処理は続行
  - 対策: 見出しベースの分割処理を実装済み、さらなる最適化が必要

- [ ] **ウェブサイト構造への依存**
  - 問題: `#main` セレクタが変更された場合、コンテンツ抽出が失敗する
  - 現状: エラーログを出力し、次のURLに進む
  - 対策: より堅牢なセレクタ戦略の検討が必要

### 中優先度

- [ ] **APIタイムアウト**
  - 問題: 大きなコンテンツの処理時にAPIタイムアウトが発生する可能性
  - 現状: タイムアウトを3分に設定
  - 対策: 自動リトライ機能の実装を検討中

- [ ] **ファイル名の衝突**
  - 問題: 特定のURLパターンでファイル名が衝突する可能性
  - 現状: URLのパス構造を使用してファイル名を生成
  - 対策: ハッシュ値の追加やより堅牢なファイル名生成アルゴリズムの検討

### 低優先度

- [ ] **メモリ使用量**
  - 問題: 大きなドキュメントを処理する際にメモリ使用量が増加
  - 現状: 許容範囲内
  - 対策: ストリーミング処理の導入を検討

- [ ] **処理速度**
  - 問題: 複数のURLを処理する際に時間がかかる
  - 現状: URLを順次処理
  - 対策: 並列処理の導入を計画中

## プロジェクト進化の履歴

### バージョン 1.0.0 (初期リリース)

- 基本的なHTML取得機能
- HTML→Markdown変換
- 英語→日本語翻訳
- 環境変数による設定

### バージョン 1.1.0 (現在の開発版)

- ファイル名の簡略化
- 大きなドキュメントの分割処理
- ファイルパス生成ロジックの改善
- 翻訳禁止単語リスト機能

### 計画中のバージョン 1.2.0

- 並列処理の導入
- 進捗表示の強化
- エラーレポートの改善
- エラーハンドリングの強化

## 主要な決定の変遷

### ファイル名生成ロジック

1. **初期実装**: URLのすべての部分を `-` で結合
   - 問題: 長く読みにくいファイル名、ディレクトリ構造の欠如
   
2. **改良版 (v1.1.0)**: URLのパス構造を反映
   - 利点: 論理的な構造の保持、関連ファイルのグループ化
   - 課題: パス処理の複雑化、ファイルシステムの制限

### コンテンツ分割戦略

1. **初期実装**: 分割なし（全体を一度に処理）
   - 問題: 大きなコンテンツでAPIのトークン制限を超える
   
2. **改良版 (v1.1.0)**: 見出しベースの階層的分割
   - 利点: 論理構造の保持、トークン制限内での処理
   - 課題: 実装の複雑化、見出しがない場合の対応

### 翻訳プロセス

1. **初期実装**: HTMLから直接日本語に翻訳
   - 問題: 処理の複雑さ、原文の保存不可
   
2. **改良版 (v1.0.0)**: 2段階処理（HTML→英語Markdown→日本語）
   - 利点: 処理の分離、原文の保存
   - 課題: 処理時間の増加、APIコールの増加
